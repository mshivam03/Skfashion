<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Skfashion Admin</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light p-5">
    <div class="container" style="max-width: 500px;">
        <div class="card p-4 shadow">
            <h3>Upload Product</h3>
            <input type="text" id="pName" class="form-control mb-2" placeholder="Product Name">
            <input type="number" id="pPrice" class="form-control mb-2" placeholder="Price">
            <input type="file" id="pImage" class="form-control mb-3">
            <button class="btn btn-primary w-100" onclick="upload()">Add to Shop</button>
            <div id="status" class="mt-3 text-center"></div>
        </div>
        <hr>
        <div id="admin-list" class="row mt-4"></div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-firestore-compat.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyDXfUVyhD3IvriizZUYiKV528bjHd8G6I4",
            authDomain: "skfashion-a7760.firebaseapp.com",
            projectId: "skfashion-a7760",
            appId: "1:651545993736:web:45a567bbd87b174e7c67bd"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        async function upload() {
            const name = document.getElementById('pName').value;
            const price = document.getElementById('pPrice').value;
            const file = document.getElementById('pImage').files[0];
            const status = document.getElementById('status');

            status.innerHTML = "Processing...";
            const data = new FormData();
            data.append('file', file);
            data.append('upload_preset', 'unsigned_preset_123');

            try {
                const res = await fetch('https://api.cloudinary.com/v1_1/dfue7hk4j/image/upload', {
                    method: 'POST', body: data
                });
                const json = await res.json();
                
                await db.collection("products").add({
                    name: name, price: price, image: json.secure_url,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
                status.innerHTML = "✅ Uploaded!";
            } catch (e) { status.innerHTML = "❌ Error!"; }
        }

        db.collection("products").onSnapshot(snap => {
            let h = "";
            snap.forEach(doc => {
                h += `<div class="col-6 mb-2">
                    <img src="${doc.data().image}" style="width:100%">
                    <button class="btn btn-danger btn-sm w-100" onclick="del('${doc.id}')">Delete</button>
                </div>`;
            });
            document.getElementById('admin-list').innerHTML = h;
        });

        async function del(id) { if(confirm("Delete?")) await db.collection("products").doc(id).delete(); }
    </script>
</body>
</html>
