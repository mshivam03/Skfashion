<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Skfashion Admin | Pro Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        :root { --gold: #c5a059; --dark: #1a1a1a; }
        body { background-color: #f0f2f5; font-family: 'Segoe UI', sans-serif; }
        .admin-header { background: var(--dark); color: white; padding: 20px 0; border-bottom: 4px solid var(--gold); }
        .nav-tabs .nav-link { color: var(--dark); fw-bold; }
        .nav-tabs .nav-link.active { border-bottom: 3px solid var(--gold); color: var(--gold); }
        .card { border-radius: 15px; border: none; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        .btn-gold { background: var(--dark); color: white; border: 1px solid var(--gold); }
        .btn-gold:hover { background: var(--gold); color: white; }
    </style>
</head>
<body>

<header class="admin-header text-center mb-4">
    <h1>SK<span style="color:var(--gold)">FASHION</span> ADMIN</h1>
</header>

<div class="container" id="mainContent" style="display:none;">
    <ul class="nav nav-tabs mb-4" id="adminTabs" role="tablist">
        <li class="nav-item">
            <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#upload">Add Product</button>
        </li>
        <li class="nav-item">
            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#inventory">Live Inventory</button>
        </li>
        <li class="nav-item">
            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#settings">Settings (Password)</button>
        </li>
    </ul>

    <div class="tab-content">
        <div class="tab-pane fade show active" id="upload">
            <div class="card p-4 mx-auto" style="max-width: 500px;">
                <h4 class="fw-bold mb-3">Add Merchandise</h4>
                <input type="text" id="pName" class="form-control mb-2" placeholder="Product Name">
                <input type="number" id="pPrice" class="form-control mb-2" placeholder="Price (INR)">
                <select id="pCategory" class="form-select mb-2">
                    <option value="Shirts">Shirts</option>
                    <option value="Suits">Suits</option>
                    <option value="Traditional">Traditional</option>
                </select>
                <input type="file" id="pImage" class="form-control mb-3">
                <button class="btn btn-gold w-100" onclick="processUpload()">Publish Product</button>
                <div id="status" class="mt-2 text-center small fw-bold"></div>
            </div>
        </div>

        <div class="tab-pane fade" id="inventory">
            <div class="card p-4">
                <table class="table align-middle">
                    <tbody id="inventory-body"></tbody>
                </table>
            </div>
        </div>

        <div class="tab-pane fade" id="settings">
            <div class="card p-4 mx-auto" style="max-width: 400px;">
                <h4 class="fw-bold mb-3">Change Admin Password</h4>
                <input type="text" id="newPass" class="form-control mb-2" placeholder="Enter New Password">
                <button class="btn btn-danger w-100" onclick="updatePassword()">Update Password</button>
                <p class="text-muted small mt-2 text-center">Note: This will update the password in Firebase.</p>
            </div>
        </div>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-firestore-compat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyDXfUVyhD3IvriizZUYiKV528bjHd8G6I4",
        authDomain: "skfashion-a7760.firebaseapp.com",
        projectId: "skfashion-a7760",
        appId: "1:651545993736:web:45a567bbd87b174e7c67bd"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // --- DYNAMIC PASSWORD CHECK ---
    async function checkAccess() {
        const doc = await db.collection("settings").doc("admin_config").get();
        const correctPass = doc.exists ? doc.data().password : "12345678"; // Fallback
        
        if (sessionStorage.getItem("sk_verified") === "true") {
            document.getElementById('mainContent').style.display = "block";
        } else {
            let attempt = prompt("Enter Admin Password:");
            if (attempt === correctPass) {
                sessionStorage.setItem("sk_verified", "true");
                document.getElementById('mainContent').style.display = "block";
            } else {
                alert("Wrong Password!");
                window.location.href = "index.html";
            }
        }
    }
    checkAccess();

    async function updatePassword() {
        const newPass = document.getElementById('newPass').value;
        if(newPass.length < 4) return alert("Password too short!");
        
        await db.collection("settings").doc("admin_config").set({ password: newPass });
        alert("Password updated in Firebase! Use the new password next time.");
        location.reload();
    }

    // --- UPLOAD LOGIC ---
    async function processUpload() {
        const name = document.getElementById('pName').value;
        const price = document.getElementById('pPrice').value;
        const category = document.getElementById('pCategory').value;
        const file = document.getElementById('pImage').files[0];
        const status = document.getElementById('status');

        if(!name || !price || !file) return alert("Fill all fields!");
        
        status.innerText = "⏳ Uploading...";
        const formData = new FormData();
        formData.append('file', file);
        formData.append('upload_preset', 'unsigned_preset_123');

        try {
            const res = await fetch('https://api.cloudinary.com/v1_1/dfue7hk4j/image/upload', { method: 'POST', body: formData });
            const data = await res.json();
            
            await db.collection("products").add({
                name, price: parseInt(price), category, image: data.secure_url,
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            });
            status.innerText = "✅ Success!";
            location.reload();
        } catch (e) { status.innerText = "❌ Error"; }
    }

    // --- INVENTORY LISTENER ---
    db.collection("products").orderBy("timestamp", "desc").onSnapshot(snap => {
        let html = "";
        snap.forEach(doc => {
            const p = doc.data();
            html += `<tr>
                <td><img src="${p.image}" style="width:50px; border-radius:5px;"></td>
                <td><b>${p.name}</b><br><small>${p.category} | ₹${p.price}</small></td>
                <td class="text-end"><button class="btn btn-sm btn-outline-danger" onclick="deleteItem('${doc.id}')">Delete</button></td>
            </tr>`;
        });
        document.getElementById('inventory-body').innerHTML = html;
    });

    async function deleteItem(id) {
        if(confirm("Delete item?")) await db.collection("products").doc(id).delete();
    }
</script>
</body>
</html>
