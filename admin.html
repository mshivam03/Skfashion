<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Skfashion | Pro Admin v2.0</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        :root { --gold: #c5a059; --dark: #1a1a1a; --bg: #f4f7f6; }
        body { background-color: var(--bg); font-family: 'Segoe UI', sans-serif; }
        .admin-header { background: var(--dark); color: white; padding: 20px 0; border-bottom: 4px solid var(--gold); }
        .nav-tabs .nav-link { color: #555; font-weight: 600; border: none; }
        .nav-tabs .nav-link.active { color: var(--gold); border-bottom: 3px solid var(--gold); background: transparent; }
        .card { border-radius: 12px; border: none; box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
        .btn-gold { background: var(--dark); color: white; border: 1px solid var(--gold); transition: 0.3s; }
        .btn-gold:hover { background: var(--gold); color: white; }
        .img-thumb { width: 50px; height: 50px; object-fit: cover; border-radius: 6px; }
    </style>
</head>
<body>

<header class="admin-header text-center mb-4">
    <h1 style="letter-spacing: 2px;">SK<span style="color:var(--gold)">FASHION</span> ADMIN</h1>
</header>

<div class="container" id="mainContent" style="display:none;">
    <ul class="nav nav-tabs mb-4 justify-content-center" id="adminTabs">
        <li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#upload">Upload</button></li>
        <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#inventory">Stock</button></li>
        <li class="nav-item"><button class="nav-link position-relative" data-bs-toggle="tab" data-bs-target="#orders">Orders <span id="orderCount" class="badge bg-danger rounded-pill"></span></button></li>
        <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#settings">Settings</button></li>
    </ul>

    <div class="tab-content">
        <div class="tab-pane fade show active" id="upload">
            <div class="card p-4 mx-auto" style="max-width: 500px;">
                <h5 class="fw-bold mb-3">Add New Item</h5>
                <input type="text" id="pName" class="form-control mb-2" placeholder="Item Name">
                <input type="number" id="pPrice" class="form-control mb-2" placeholder="Price (INR)">
                <select id="pCategory" class="form-select mb-3">
                    <option value="Shirts">Shirts</option>
                    <option value="Suits">Suits</option>
                    <option value="Traditional">Traditional</option>
                </select>
                <input type="file" id="pImage" class="form-control mb-3">
                <button class="btn btn-gold w-100 py-2 fw-bold" onclick="processUpload()">PUBLISH PRODUCT</button>
                <div id="status" class="mt-2 text-center small fw-bold"></div>
            </div>
        </div>

        <div class="tab-pane fade" id="inventory">
            <div class="card p-3">
                <table class="table align-middle">
                    <tbody id="inventory-body"></tbody>
                </table>
            </div>
        </div>

        <div class="tab-pane fade" id="orders">
            <div class="card p-3">
                <h5 class="fw-bold mb-3">Customer Purchase Intents</h5>
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead class="table-light">
                            <tr><th>Time</th><th>Product</th><th>Price</th><th>Action</th></tr>
                        </thead>
                        <tbody id="orders-body"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="tab-pane fade" id="settings">
            <div class="card p-4 mx-auto" style="max-width: 400px;">
                <h5 class="fw-bold mb-3">System Settings</h5>
                <label class="small fw-bold">Update Password</label>
                <input type="text" id="newPass" class="form-control mb-3" placeholder="New Password">
                <button class="btn btn-danger w-100" onclick="updatePassword()">Save Password</button>
            </div>
        </div>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-firestore-compat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyDXfUVyhD3IvriizZUYiKV528bjHd8G6I4",
        authDomain: "skfashion-a7760.firebaseapp.com",
        projectId: "skfashion-a7760",
        appId: "1:651545993736:web:45a567bbd87b174e7c67bd"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // --- ACCESS SECURITY ---
    async function checkAccess() {
        const doc = await db.collection("settings").doc("admin_config").get();
        const correctPass = doc.exists ? doc.data().password : "12345678";
        
        if (sessionStorage.getItem("sk_verified") !== "true") {
            let attempt = prompt("Enter Admin Password:");
            if (attempt === correctPass) {
                sessionStorage.setItem("sk_verified", "true");
            } else {
                alert("Denied!"); window.location.href = "index.html"; return;
            }
        }
        document.getElementById('mainContent').style.display = "block";
    }
    checkAccess();

    // --- SETTINGS ---
    async function updatePassword() {
        const p = document.getElementById('newPass').value;
        if(p.length < 4) return alert("Too short!");
        await db.collection("settings").doc("admin_config").set({ password: p });
        alert("Updated!"); location.reload();
    }

    // --- UPLOAD ---
    async function processUpload() {
        const n = document.getElementById('pName').value, pr = document.getElementById('pPrice').value, 
              c = document.getElementById('pCategory').value, f = document.getElementById('pImage').files[0];
        if(!n || !pr || !f) return alert("Fill all!");
        document.getElementById('status').innerText = "‚è≥ Uploading...";
        
        const fd = new FormData(); fd.append('file', f); fd.append('upload_preset', 'unsigned_preset_123');
        const res = await fetch('https://api.cloudinary.com/v1_1/dfue7hk4j/image/upload', { method: 'POST', body: fd });
        const d = await res.json();
        
        await db.collection("products").add({
            name: n, price: parseInt(pr), category: c, image: d.secure_url,
            timestamp: firebase.firestore.FieldValue.serverTimestamp()
        });
        location.reload();
    }

    // --- LIVE DATA LISTENERS ---
    // 1. Inventory
    db.collection("products").orderBy("timestamp", "desc").onSnapshot(snap => {
        let h = "";
        snap.forEach(doc => {
            const p = doc.data();
            h += `<tr><td><img src="${p.image}" class="img-thumb"></td><td><b>${p.name}</b><br><small>‚Çπ${p.price}</small></td><td class="text-end"><button class="btn btn-sm text-danger" onclick="db.collection('products').doc('${doc.id}').delete()">üóëÔ∏è</button></td></tr>`;
        });
        document.getElementById('inventory-body').innerHTML = h;
    });

    // 2. Orders
    db.collection("orders").orderBy("timestamp", "desc").onSnapshot(snap => {
        let h = "";
        document.getElementById('orderCount').innerText = snap.size > 0 ? snap.size : "";
        snap.forEach(doc => {
            const o = doc.data();
            const time = o.timestamp ? new Date(o.timestamp.seconds * 1000).toLocaleDateString() : "...";
            h += `<tr><td>${time}</td><td>${o.productName}</td><td>‚Çπ${o.price}</td><td class="text-end"><button class="btn btn-sm btn-outline-secondary" onclick="db.collection('orders').doc('${doc.id}').delete()">Done</button></td></tr>`;
        });
        document.getElementById('orders-body').innerHTML = h || "<tr><td colspan='4' class='text-center'>No new orders</td></tr>";
    });

</script>
</body>
</html>
